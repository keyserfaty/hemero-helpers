const test1 = {
  "title": "Desplazan al director del penal de Ezeiza por un presunto plan de fuga de \"Mi Sangre\"",
  "subtitle": "18:57 › LO VINCULARON JUNTO CON OTROS DOS FUNCIONARIOS DE ESA CARCEL",
  "text": "El Servicio Penitenciario Federal pasó a disponibilidad al director del penal de Ezeiza, Héctor Retamozo, y otros dos funcionarios luego de que se descubriera un presunto plan de fuga por parte de un grupo comando del supuesto narco colombiano Jésus López Londoño, alias \"Mi Sangre\".Según consignó la agencia Télam, López Londoño, el ciudadano colombiano detenido desde 2012 por estar acusado de ser parte de una organización narcotraficante, iba a ser rescatado del penal de Ezeiza por un grupo comando para evitar su extradición a Estados Unidos.Fuentes del Servicio Penitenciario Federal (SPF) informaron a la agencia oficial que la situación se descubrió ayer a las 14, luego de que se detectara que María Gabriela Ricagno, abogada de López Londoño, intentara ingresar a la cárcel con un plano de los terrenos del penal de Ezeiza.En el mapa -siempre según Télam- también figuraban la ubicación detallada de comisarí­as y otras dependencias policiales próximas al penal, así como los barrios aledaños hasta el partido de Esteban Echeverría y una posible línea de escape trazada en rojo hacia Cañuelas.Ante esta situación, la abogada fue demorada y recién liberada a las 21 y se dio intervencion al juez federal de Lomas de Zamora Federico Villena y a todas las fuerzas de seguridad para que estuvieran alerta.El magistrado ordenó que se revisara la celda de López Londoño y allí se habrían hallado fotocopias de expedientes y, dentro de ellas, en un hueco, un teléfono celular Iphone, dos chips y un módem portátil.El presunto narco también guardaba un centenar de discos compactos, que al ser revisados tenían grabados videos del espacio aéreo del penal, lo que -sumado a los elementos anteriores- hizo creer a los investigadores que iba a ser rescatado por un grupo comando, por ejemplo, utilizando un helicóptero.Por eso, esta tarde fue pasado a disponibilidad el director del penal, Héctor Retamozo, y otros dos funcionarios que se cree que tuvieron vinculación con el ingreso del teléfono y los otros elementos hallados.En tanto, la Jefatura de Asuntos Internos del SPF investiga a todos los efectivos que mantuvieron contacto con el detenido el viernes y los días anteriores, que por ahora no están cumpliendo funciones.López Londoño tení­a pedido de captura internacional, acusado de ser jefe del cartel \"Los Urabeños\", y estaba negociando desde hace algunos meses su entrega ante la Justicia de su paí­s. Fue apresado en la ciudad de Pilar el 30 de octubre de 2012 y el operativo estuvo a cargo de la entonces Secretarí­a de Inteligencia (SI), que contó con la colaboración de la Dirección de Policí­a Judicial Colombiana y de Interpol Colombia.Pese a que Estados Unidos pidió formalmente su extradición apenas dos meses después de la detención, la defensa de \"Mi Sangre\" presentó numerosos recursos ante la Justicia para recusar a distintos jueces que iban interviniendo en su causa.",
  "paper": "pagina12"
};

const test2 = {
  "title": "Descubren un plan de fuga de \"Mi Sangre\" y separan preventivamente al director del penal de Ezeiza",
  "subtitle": "El líder narco colombiano tenía un celular y estaba por obtener un mapa con la ubicación detallada de comisarías y dependencias policiales próximas a la cárcel",
  "text": "El director del penal de Ezeiza, Héctor Retamozo, fue separado de su cargo preventivamente luego de que se descubriera que el líder narco colombiano Henry de Jesús López Londoño, alias         \"Mi Sangre\"  planeaba fugarse.Así lo informaron fuentes oficiales a LA NACION. No descartan que se desvincule a otros funcionarios en el  marco de la misma investigación.El Complejo Penitenciario Federal I, conocido como la cárcel de Ezeiza, es el penal más grande del país. Habilitado en 1999, tiene capacidad para 2193 hombres y, según los últimos datos disponibles, hay 2069 presos alojados en esta prisión. La mayoría de los internos están detenidos por infracción a la ley de drogas, delitos contra la propiedad y contra las personas.El penal cuenta con seis módulos, una unidad de ingreso y el Hospital Penitenciario Central (HPC). Cada módulo se divide en pabellones, que cuentan con celdas individuales y un sector común.En los últimos años, se convirtió en el lugar de alojamiento de los presos de los casos más resonantes.  Además de Londoño, se encuentran en Ezeiza       José López,  ex secretario de Obras Públicas,  Jorge Chueco, el abogado cercano a       Lázaro Báez, mencionado en la declaración de Leonardo Fariña;       Martín y Cristian Lanatta y Víctor Schillaci,  condenados por el triple crimen de General Rodríguez; Jorge Mangeri, el encargado del edificio en el que vivía Ángeles Rawson;       Ricardo Jaime,  ex funcionario kirchnerista, Lázaro Báez, el empresario afín a los Kirchner; y Daniel Pérez Gadin, el contador de Lázaro Báez.\"Mi sangre\" está detenido en la Argentina desde 2012. Esta semana se descubrió que tenía en su poder un teléfono celular y que estaba por obtener un mapa con la ubicación detallada de comisarías y dependencias policiales próximas al penal, por lo que autoridades judiciales y penitenciarias creen que planeaba fugarse, informó el Servicio Penitenciario Federal (SPF).Los objetos fueron detectados ayer por personal del SPF, quienes por su estatus de \"interno de alto riesgo\" someten a \"Mi Sangre\" a controles de seguridad exhaustivos especiales.Según dijeron los voceros consultados, el mapa le fue secuestrado a su abogada defensora, María Gabriela Ricagno, entre distintos papeles que presentó ante la requisa en el momento en el que ingresaba este viernes a visitar a su cliente, en el pabellón de máxima seguridad del penal de Ezeiza.El teléfono, en tanto, fue incautado durante una revisión en la celda de López Londoño.A partir de ambos elementos, las autoridades sospechan que \"Mi Sangre\" estaba organizando fugarse de la cárcel y apartaron a los efectivos penitenciarios encargados de su custodia hasta que se lleve adelante una investigación interna que determine si prestaron colaboración para hacerse con el celular.De acuerdo con fuentes penitenciarias, las sospechas acerca un intento de evasión del sindicado narco colombiano se acrecientan por su situación procesal, ya que López Londoño apeló el fallo del juez federal 2 Sebastián Ramos, que en mayo resolvió su extradición a Estados Unidos, y actualmente aguarda la decisión de la Corte Suprema de Justicia de la Nación por su caso.López Londoño fue apresado el 30 de octubre de 2012 cuando cenaba junto a allegados y custodios en el restaurante \"Fettucine Mario\" del partido bonaerense de Pilar.El operativo de detención estuvo a cargo de la entonces Secretaría de Inteligencia (SI), que contó con la colaboración de la Dirección de Policía Judicial Colombiana y de Interpol Colombia.López Londoño, que había ingresado diez meses antes a la Argentina, tenía pedido de captura internacional, acusado de ser jefe del cartel \"Los Urabeños\", y estaba negociando desde hace algunos meses su entrega ante la Justicia de su país.Pese a que Estados Unidos pidió formalmente su extradición apenas dos meses después de la detención, la defensa de \"Mi Sangre\" presentó numerosos recursos ante la Justicia para recusar a distintos jueces que iban interviniendo en su causa.Además, logró suspender en dos ocasiones el juicio que debía efectuarse antes de ser enviado al tribunal de Florida, ya que su intención es quedarse en el país, donde viven su esposa y sus hijos.Con la colaboración de Sol Amaya",
  "paper": "lanacion"
};

////////////////////////////////////////////////////////////////////////
// Constants and helpers ///////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////

// Constants
const upperList = [ 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
const skippedWords = ["ante", "según", "las", "que", "la", "de", "en", "o", "pudo", "desde", "habían", "el", "del", "fue", "con", "que", "su", "un", "yo", "la", "los", "una", "quien", "y", "al", "de", "para", "se", "por", "haber", "sido", "le", "esa", "qué", "fueron", "aquí", "allí", "ahí", "allá", "acá", "arriba", "abajo", "cerca", "lejos", "delante", "detrás", "encima", "debajo", "enfrente", "atrás", "alrededor", "antes", "después", "luego", "pronto", "tarde", "temprano", "todavía", "aún", "ya", "ayer", "hoy", "mañana", "siempre", "nunca", "jamás", "próximamente", "prontamente", "anoche", "enseguida", "ahora", "mientras", "anteriormente", "bien", "mal", "regular", "despacio", "deprisa", "así", "tal", "como", "aprisa", "adrede", "peor", "mejor", "fielmente", "estupendamente", "fácilmente", "negativamente", "responsablemente", "muy", "poco", "mucho", "bastante", "más", "menos", "algo", "demasiado", "casi", "solo", "solamente", "tan", "tanto", "todo", "nada", "aproximadamente", "sí", "también", "cierto", "ciertamente", "efectivamente", "claro", "exacto", "obvio", "verdaderamente", "seguramente", "asimismo", "etc", "no", "jamás", "nunca", "tampoco", "primeramente", "últimamente", "quizás", "quizá", "acaso", "probablemente", "posiblemente", "seguramente", "tal", "vez", "puede", "puede", "ser", "a", "lo", "mejor", "cuándo", "cómo", "cuánto", "dónde", "solo", "solamente", "aún", "inclusive", "además", "únicamente", "incluso", "mismamente", "propiamente", "precisamente", "concretamente", "viceversa", "contrariamente", "siquiera", "consecuentemente"];

// Helpers
const existy = arg => arg != null;
const isUpper = elem => upperList.indexOf(elem[0]) !== -1;
const buildArray = obj =>
  Object.keys(obj)
    .reduce((res, key) => {
      const e = {
        name: key,
        count: obj[key]
      };

      res.push(e);
      return res;
    }, []);

const buildObject = arr =>
  arr
    .reduce((res, elem) => {
      res[elem.name] = elem.count;
      return res;
    }, {});

const abs = x => x < 0 ? -x : x;

////////////////////////////////////////////////////////////////////////
// Parsers /////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////

/**
 * Returns an array of words from the news.
 * @param news: Object. The props of the object must contain strings
 */
const parsedWords = news =>
  Object.keys(news)
    // WEIRD: I'm changing the subtitle to lowercase to avoid mistakes
    .map(e => e === 'subtitle' ? news[e].toLowerCase() : news[e])
    .join()
    .split(new RegExp('\"|,|-|›| '))
    .map(e => e.trim())
    .map(e => e.includes('.') ? e[1].toLocaleLowerCase() + e.slice(2) : e)
    .filter(e => e.length);

const wordsP = parsedWords(test1);
const wordsLN = parsedWords(test2);

////////////////////////////////////////////////////////////////////////
// Word counting operations ////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////

/**
 * Return an array of words with a `count` prop with
 * the appearance of the word
 * @param names: Array
 */
const getWordsCount = names =>
  buildArray(names
    .reduce((res, e) => {
      if (res.hasOwnProperty(e)) {
        res[e] = res[e] + 1;
      }

      if (!res.hasOwnProperty(e)) {
        res[e] = 1;
      }

      return res;
    }, {}))
    .sort((a, b) => a.count - b.count);

/**
 * Return an array of words when the is more than
 * one appearance and there are no words from the
 * skipped list
 * @param names: Array
 */
const getRelevantWordsCount = names =>
  names
    .filter(elem => elem.count !== 1)
    .filter(e => skippedWords.indexOf(e.name) === -1)
    .sort((a, b) => a.count - b.count);

////////////////////////////////////////////////////////////////////////
// Proper nouns counting operations ////////////////////////////////////
////////////////////////////////////////////////////////////////////////

/**
 * Returns an array of proper nouns from the list of words.
 * Any word that starts with an uppercase will appear on the list
 * except from the ones that start a sentence which are removed
 * in the parsedWords fn.
 * TODO: Should probably not do that. Could be considered a side effect
 * @param names: Array
 */
const getNames = names =>
  names
    .reduce((res, e, i, arr) => {
      if (isUpper(e) && existy(arr[i - 1]) && !isUpper(arr[i - 1])) {
        res.push(e);
        return res;
      }

      if (isUpper(e) && existy(arr[i - 1]) && isUpper(arr[i - 1])) {
        res[res.length - 1] = res[res.length - 1] + ' ' + e;
        return res;
      }

      return res;
    }, []);

/**
 * Returns and object with proper nouns and
 * the number of appearances of each
 * @param names: Array
 */
const getNamesCount = names => getWordsCount(getNames(names));

/**
 * Remove repeated words. Return the one that includes all the rest
 * and has the greatest number and remove all repeated ones.
 * @param names: Array
 */
const reduceNames = names =>
  getNamesCount(names)
    .sort((curr, prev) => curr.name.length - prev.name.length)
    .reduce((res, e, i, arr) => {
      const wordCount = arr.reduce((sum, elem) => elem.name.includes(e.name)
          ? sum + elem.count
          : sum, 0);

      const wordSynonyms =
        arr
          .filter(elem => elem.name.includes(e.name))
          .filter(elem => elem.name !== e.name)
          .map(elem => elem.name);

      const result = {
        name: e.name,
        synonyms: wordSynonyms,
        count: wordCount
      };

      res.push(result);
      return res;
    }, [])
    .sort((curr, prev) => curr.name.length - prev.name.length)
    .filter((e, i, arr) => !arr.some(elem => elem.synonyms.indexOf(e.name) !== -1));

/**
 * Returns an array of words with more than
 * one appearance.
 * @param names
 */
const getRelevantNames = names =>
  reduceNames(names)
    .filter(elem => elem.count !== 1)
    .sort((a, b) => a.count - b.count);

////////////////////////////////////////////////////////////////////////
// Numbers counting operations /////////////////////////////////////////
////////////////////////////////////////////////////////////////////////

const getNumbers = names =>
  names
    // WEIRD: Checks if the first character is a number to bring dates and hours
    .filter(e => !isNaN(Number(e[0])));

const getNumbersCount = numbers => getWordsCount(getNumbers(numbers));

////////////////////////////////////////////////////////////////////////
// Analysis operations /////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////

/**
 * Returns an object of the form [word]: [word appearance percentage]
 * with percentage of how important the word is according to the number
 * of times it appears on the article.
 * @param names
 */
const appearancePercentage = names =>
  names
    .reduce((res, elem) => {
      const total = names.reduce((sum, e) => sum + e['count'], 0);

      const e = {
        name: elem.name,
        synonyms: elem.synonyms,
        percentage: Number((elem.count / total * 100).toFixed(2))
      };

      res.push(e);
      return res;
    }, []);

/**
 *
 * @param list: Array
 * @param n: Number
 */
const filterMostRelevant = (list, n) =>
  appearancePercentage(list)
    .sort((curr, prev) => curr.percentage - prev.percentage)
    .reverse()
    .filter((e, i) => i < n);

/**
 * Return words that are equal into an array with those two elements
 * @param a: Array
 * @param b: Array
 */
const extractEquals = (a, b) =>
  a
    .reduce((res, e) => {
      const isPresent = (e1, e2) => e1.name === e2.name || e2.synonyms.indexOf(e1.name) !== -1 || e1.synonyms.indexOf(e2.name) !== -1;
      const result = [
        b.filter(elem => isPresent(e, elem))[0] || null,
        e
      ];

      res.push(result);
      return res;
    }, []);

/**
 * Its kind of a lying function but here's what it does:
 * Up to this point you have an array with n elements.
 * Each element is an array of words that refer to the same word.
 * For example you could have:
 * ['cristina', 'cristina kirchner', 'CFK']
 *
 * All these there words all virtually the same and for each of these
 * groups you have a percentage. This percentage represents how
 * important are this words to the main subject of the article.
 * You could have for example a 21.44 (this is a big number).
 *
 * On the other hand you will have the other article from a different journal
 * and the same data: ['cristina', 'cristina kirchner', 'CFK'] maybe in a different
 * order or with some additions. You could have for instance
 * ['cristina', 'cristina kirchner', 'CFK', 'cristina fernandez de kirchner'] and with
 * this list you will also have how important this word (or group of words)
 * are for these other article. You could have a 18.22.
 *
 * What the function does is it takes this two values (18.22 and 21.44) and it
 * subtracts on an other an then returns the absolute value of these operation.
 * In this case this would be: 3.22.
 *
 * It will do this for all group of words you have. So you finally will end up with
 * a group of numbers: 3.22, 2.33, 8.22.
 * It will then take the biggest one and will subtract 100 to it and the return its absolute
 * number. In this case: 100 - 8.22 = 91.78 and this is the number it will return.
 *
 * This number is suppose to be the similarity index of both articles.
 *
 * @param list
 */
const buildSimilarityIndex = list =>
  abs(list
    .reduce((res, e) => {
      const firstPercentage = e[0].percentage;
      const secondPercentage = e[1].percentage;
      
      const diffPercentage = abs(firstPercentage - secondPercentage);

      res.push(diffPercentage);
      return res;
    }, [])
    .reduce((prev, curr) => prev > curr ? prev : curr)
    - 100
  ).toFixed(2);

const pagina = filterMostRelevant(getRelevantNames(wordsP), 3);
const LN = filterMostRelevant(getRelevantNames(wordsLN), 3);
console.log(buildSimilarityIndex(extractEquals(pagina, LN)))


